{% extends 'base.html' %}

{% block content %}
{% load static %}


      <!-- ========== signin-section start ========== -->
      <section class="signin-section">
        <div class="container-fluid">
          <!-- ========== title-wrapper start ========== -->
          <div class="title-wrapper pt-30">
            <div class="row align-items-center">
              <div class="col-md-6">
                <div class="title">
                  <h2>SMART INVEST</h2>
                </div>
              </div>
              <!-- end col -->
              <div class="col-md-6">
                <div class="breadcrumb-wrapper">
                  <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                      <li class="breadcrumb-item">
                        <a href="#0">TABLEAU DE BORD</a>
                      </li>
                      <li class="breadcrumb-item"><a href="#0">AUTHENTIFICATION</a></li>
                      <li class="breadcrumb-item active" aria-current="page">
                        INSCRIPTION
                      </li>
                    </ol>
                  </nav>
                </div>
              </div>
              <!-- end col -->
            </div>
            <!-- end row -->
          </div>
          <!-- ========== title-wrapper end ========== -->

          <div class="row g-0 auth-row">
            <div class="col-lg-6">
              <div class="auth-cover-wrapper bg-primary-100">
                <div class="auth-cover" style="font-weight: 900;">
                  <div class="title text-center">
                    <h1 class="text-primary mb-10">BIENVENUE SUR <br><b>SMART INVEST</b></h1>
                    <p class="text-medium"><b>
                     Remplissez les informations pour creer votre compte
                     
                      et commencer une experience hors du commun.</b>
                    </p>
                  </div>
                  <div class="cover-image">
                    <img src="{% static 'assets/images/auth/sign up.png' %}" alt="" />
                  </div>
                  <div class="shape-image">
                    <img src="{% static 'assets/images/auth/piece2.png' %}" width="700" alt="" />
                  </div>
                </div>
              </div>
            </div>
            <!-- end col -->
            <div class="col-lg-6">
              <div class="signup-wrapper">
                <div class="form-wrapper">
                  <h6 class="mb-15">Formulaire d'Inscription</h6>
                  <p class="text-sm mb-25">
                    Les Informations que vous-y mettrez servirons a effectuer vos transactions.
                  </p>
                  <form action="{% url 'inscription' %}" method="post">
                    {% csrf_token %}
                    <div class="row">
                      <div class="col-12">
                        <div class="input-style-1">
                          <label>Telephone</label>
                          <input type="tel" name="telephone" id="telephone" placeholder="+237..."  required/>
                        </div>
                      </div>
                      <!-- end col -->
                      <div class="col-12">
                        <div class="input-style-1">
                          <label>Telephone2(facultatif)</label>
                          <input type="tel" name="telephone2" id="telephone2" placeholder="+237..." />
                        </div>
                      </div>
                      <!-- end col -->
                      <div class="col-12">
                        <div class="input-style-1">
                          <label>Votre Nom</label>
                          <input type="text" placeholder="Nom" name="nom" id="nom" required />
                        </div>
                      </div>
                      <!-- end col -->
                     
                     
                     {% if code %}
                       <div class="col-12">
                         <div class="input-style-1">
                           <label>CODE DU PARRAIN</label>
                           <input type="text" value="{{code}}" name="codeParrain" id="codeParrain" disabled/>
                         </div>
                       </div>
                       <!-- end col -->
                     {% endif %}
                      
                      <div class="col-12">
                        <div class="input-style-1">
                          <label>Mot de Passe</label>
                          <input type="password" placeholder="Definissez un mot de passe" name="password" id="password" required  />
                        </div>
                      </div>
                      <!-- end col -->
                      <div class="col-12">
                        <div class="input-style-1">
                          <label>Confirmer Mot de Passe</label>
                          <input type="password" placeholder="Confirmez le  mot de passe" name="passwordConf" id="passwordConf" required  />
                        </div>
                      </div>
                      <!-- end col -->
                      <div class="col-12">
                        <div class="form-check checkbox-style mb-30">
                          <input class="form-check-input" type="checkbox" value="" id="checkbox-not-robot" required  />
                          <label class="form-check-label" for="checkbox-not-robot">
                            J'accepte la <a href="{% url 'politique' %}">Politique de Smart Invest</a></label>
                        </div>
                      </div>
                      <!-- end col -->
                      <div class="col-xxl-6 col-lg-12 col-md-6">
                        <div class="form-check checkbox-style mb-30">
                          <input class="form-check-input" type="checkbox" value="" name="remember-me" id="checkbox-remember" />
                          <label class="form-check-label" for="checkbox-remember">
                            Se souvenir de moi sur cet appareil</label>
                        </div>
                      </div>
                      <!-- end col -->
                      
                    <div class="col-12">
                      <p style="text-align: center;">
                        <label  style="color: red;font-weight:700" id="MessageErreur"></label>
                  </p>
                    </div>
                      <div class="col-12">
                        <div class="button-group d-flex justify-content-center flex-wrap">
                          <a href="#" onclick="send_data()" class="main-btn primary-btn btn-hover w-100 text-center">
                            Creer Un compte
                          </a>
                        </div>
                      </div>
                    </div>
                    <!-- end row -->
                  </form>

                  <div class="singup-option pt-40">
                    
                    <p class="text-sm text-medium text-dark text-center">
                      Vous avez deja un Compte ? <a href="{% url 'connexion' %}">Connectez-vous</a>
                    </p>
                  </div>

                  
                  <script>
                    function sub() {
                        document.getElementById("btnSub").click();
                    }
                    function getCookie(name) {
                        // Cette fonction renvoie la valeur du cookie nommé name, ou null si le cookie n'existe pas
                        var cookieValue = null;
                        if (document.cookie && document.cookie !== "") {
                            var cookies = document.cookie.split(";");
                            for (var i = 0; i < cookies.length; i++) {
                                var cookie = cookies[i].trim();
                                // Vérifier si le cookie commence par le nom recherché
                                if (cookie.substring(0, name.length + 1) === name + "=") {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }

                    function send_data() {

                        // Récupérer les données du formulaire
                        var name = document.getElementById("nom").value;
                        var password = document.getElementById("password").value;
                        var codeParrain = document.getElementById("codeParrain").value;
                        var telephone = document.getElementById("telephone").value;
                        var telephone2 = document.getElementById("telephone2").value;
                        var confpassword = document.getElementById("passwordConf").value;
                        var checkboxremember=document.getElementById("checkbox-remember").checked

                        // Créer un objet FormData pour stocker les données du formulaire
                        var form_data = new FormData();
                        form_data.append("nom", name);
                        form_data.append("password", password);
                        form_data.append("codeParrain",codeParrain);
                        form_data.append("telephone", telephone);
                        form_data.append("telephone2", telephone2);
                        form_data.append("passwordConf", confpassword);
                        form_data.append("remember-me", checkboxremember);

                        // Créer un objet XMLHttpRequest pour envoyer la requête Ajax
                        var xhr = new XMLHttpRequest();

                        xhr.open("POST", "/inscription/", true); // Remplacer "/singup/" par l'URL de votre vue Django
                        xhr.setRequestHeader("X-CSRFToken", getCookie("csrftoken")); // Ajouter le token CSRF pour la sécurité
                        xhr.onload = function () {
                            // Traiter la réponse du serveur
                            if (xhr.status == 200) {
                                // La requête a réussi
                                var response = JSON.parse(xhr.responseText); // Convertir la réponse en objet JSON
                                if (response.success) {
                                    // L'inscription ou la connexion a réussi
                                    window.location.href = response.redirect_url; // Rediriger l'utilisateur vers une autre page
                                } else {
                                  //alert(response.message);
                                    // L'inscription ou la connexion a échoué
                                    document.getElementById("MessageErreur").innerHTML = response.message; // Afficher le message d'erreur
                                }
                            } else {
                                // La requête a échoué
                                document.getElementById("MessageErreur").innerHTML = "OUPS !! Une Erreur s'est produite "; // Afficher un message générique
                            }
                        };
                        xhr.send(form_data); // Envoyer les données du formulaire
                    }

                </script>

                </div>
              </div>
            </div>
            <!-- end col -->
          </div>
          <!-- end row -->
        </div>
      </section>
      <!-- ========== signin-section end ========== -->
      {% endblock %}